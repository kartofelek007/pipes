var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,r=(e,t)=>{for(var i in t||(t={}))n.call(t,i)&&o(e,i,t[i]);if(s)for(var i of s(t))a.call(t,i)&&o(e,i,t[i]);return e},c=(e,s)=>t(e,i(s));const p={check:!1,active:!1},d=[c(r({},p),{icon:" ",points:"",inactive:!0,type:0}),c(r({},p),{icon:"←",points:"L",inactive:!0,type:1,types:[1,2,3,4]}),c(r({},p),{icon:"↑",points:"T",inactive:!0,type:2,types:[1,2,3,4]}),c(r({},p),{icon:"→",points:"R",inactive:!0,type:3,types:[1,2,3,4]}),c(r({},p),{icon:"↓",points:"B",inactive:!0,type:4,types:[1,2,3,4]}),c(r({},p),{icon:"│",points:"TB",type:5,types:[5,6]}),c(r({},p),{icon:"─",points:"LR",type:6,types:[5,6]}),c(r({},p),{icon:"┘",points:"LT",type:7,types:[7,8,9,10]}),c(r({},p),{icon:"└",points:"RT",type:8,types:[7,8,9,10]}),c(r({},p),{icon:"┌",points:"RB",type:9,types:[7,8,9,10]}),c(r({},p),{icon:"┐",points:"LB",type:10,types:[7,8,9,10]}),c(r({},p),{icon:"┤",points:"LTB",type:11,types:[11,12,13,14]}),c(r({},p),{icon:"┴",points:"LRT",type:12,types:[11,12,13,14]}),c(r({},p),{icon:"├",points:"RTB",type:13,types:[11,12,13,14]}),c(r({},p),{icon:"┬",points:"LRB",type:14,types:[11,12,13,14]}),c(r({},p),{icon:"┼",points:"LRTB",inactive:!0,type:15,types:[15]}),c(r({},p),{icon:"◄",points:"L",inactive:!0,type:16,types:[16,17,18,19]}),c(r({},p),{icon:"▲",points:"T",inactive:!0,type:17,types:[16,17,18,19]}),c(r({},p),{icon:"►",points:"R",inactive:!0,type:18,types:[16,17,18,19]}),c(r({},p),{icon:"▼",points:"B",inactive:!0,type:19,types:[16,17,18,19]}),c(r({},p),{icon:"╥",points:"B",inactive:!0,type:20,types:[20,21,22,23]}),c(r({},p),{icon:"╡",points:"L",inactive:!0,type:21,types:[20,21,22,23]}),c(r({},p),{icon:"╨",points:"T",inactive:!0,type:22,types:[20,21,22,23]}),c(r({},p),{icon:"╞",points:"R",inactive:!0,type:23,types:[20,21,22,23]}),c(r({},p),{icon:"║",points:"TB",inactive:!0,type:24,types:[24,25]}),c(r({},p),{icon:"═",points:"LR",inactive:!0,type:25,types:[24,25]}),c(r({},p),{icon:"╝",points:"LT",inactive:!0,type:26,types:[26,27,28,29]}),c(r({},p),{icon:"╚",points:"RT",inactive:!0,type:27,types:[26,27,28,29]}),c(r({},p),{icon:"╔",points:"RB",inactive:!0,type:28,types:[26,27,28,29]}),c(r({},p),{icon:"╗",points:"LB",inactive:!0,type:29,types:[26,27,28,29]}),c(r({},p),{icon:"●",inactive:!0,type:30})],l=d.filter((e=>e.points&&e.points.includes("L"))).map((e=>e.type)),h=d.filter((e=>e.points&&e.points.includes("R"))).map((e=>e.type)),v=d.filter((e=>e.points&&e.points.includes("T"))).map((e=>e.type)),y=d.filter((e=>e.points&&e.points.includes("B"))).map((e=>e.type)),g=d.filter((e=>[16,17,18,19,20,21,22,23].includes(e.type))).map((e=>e.type));class u{constructor({icon:e,type:t,inactive:i=!1,points:s,active:n},a){this.points=s,this.check=!1,this._icon=e,this._type=t,this._active=n,this._inactive=i,this._draggable=!1,this._animationEndFn=a,this._div=u.generateHTML(this._active,this._inactive,this._type),this._active&&this._div.classList.add("pipe-active"),this._inactive&&(this._div.dataset.inactive=!0),this._div.dataset.type=this._type,this.bindEvents()}changePipe(){this._type>=1&&this._type<=4&&(this._type++,this._type>4&&(this._type=1)),this._type>=5&&this._type<=6&&(this._type++,this._type>6&&(this._type=5)),this._type>=7&&this._type<=10&&(this._type++,this._type>10&&(this._type=7)),this._type>=11&&this._type<=14&&(this._type++,this._type>14&&(this._type=11)),this.points=d.find((e=>e.type===this._type)).points,this._div.dataset.type=this._type}clickOnTile(e){if(!this._inactive){const e=parseInt(getComputedStyle(this._div).getPropertyValue("--rotate"));this._div.style.setProperty("--rotate",`${e+90}deg`),this.changePipe(),this._div.addEventListener("transitionend",(e=>{this._animationEndFn()}))}}static generateHTML(e,t,i){const s=document.createElement("div");return s.innerHTML='\n            <div class="pipe-inside">\n                <div class="pipe-active-textures">\n                    <div class="pipe-active-texture1"></div>\n                    <div class="pipe-active-texture2"></div>\n                    <div class="pipe-active-texture3"></div>\n                </div>\n            </div>\n        ',s.classList.add("pipe"),e&&s.classList.add("pipe-active"),t&&(s.dataset.inactive=!0),s.dataset.type=i,s}set active(e){this._active=e,this._active?(console.log(this._div),this._div.classList.add("pipe-active")):this._div.classList.remove("pipe-active")}get active(){return this._active}get div(){return this._div}set inactive(e){this._div.dataset.inactive=e,this._inactive=e}set icon(e){this._icon=e}get icon(){return this._icon}get type(){return this._type}get inactive(){return this._inactive}set draggable(e){this._div.draggable=e,this._draggable=e}get draggable(){return this._draggable}bindEvents(){this.clickOnTile=this.clickOnTile.bind(this),this._div.addEventListener("click",this.clickOnTile)}unbindEvents(){this._div.removeEventListener("click",this.clickOnTile)}}class m{constructor(e,t,i){this.element=e,this.dropAreas=[...t],this.areaFrom=null,this.areaDrop=null,this.options=r(r({},{onDragStart:(e,t,i)=>{},onDragEnd:(e,t,i,s)=>{},onDragEnter:(e,t,i,s)=>{},onDragLeave:(e,t,i,s)=>{},onDragDrop:(e,t,i,s)=>{}}),i),this.dragStart=this.dragStart.bind(this),this.dragEnd=this.dragEnd.bind(this),this.dragOver=this.dragOver.bind(this),this.dragEnter=this.dragEnter.bind(this),this.dragLeave=this.dragLeave.bind(this),this.dragDrop=this.dragDrop.bind(this)}dragStart(e){e.effectAllowed="move",e.target.classList.add("dragged"),this.areaDrop=null,this.areaFrom=e.target.parentElement,console.log(this.dropAreas),document.addEventListener("dragover",this.dragOver),document.addEventListener("dragenter",this.dragEnter),document.addEventListener("dragleave",this.dragLeave),document.addEventListener("drop",this.dragDrop),this.options.onDragStart(e,this.element,this.dropAreas)}dragEnd(e){document.removeEventListener("dragover",this.dragOver),document.removeEventListener("dragenter",this.dragEnter),document.removeEventListener("dragleave",this.dragLeave),document.removeEventListener("drop",this.dragDrop),this.options.onDragEnd(e,this.element,this.areaFrom,this.areaDrop)}dragOver(e){e.preventDefault()}dragEnter(e){e.preventDefault();const t=[...this.dropAreas].find((t=>t===e.target));t&&this.options.onDragEnter(e,this.element,t,this.areaFrom)}dragLeave(e){const t=[...this.dropAreas].find((t=>t===e.target));t&&this.options.onDragLeave(e,this.element,t,this.areaFrom)}dragDrop(e){const t=[...this.dropAreas].find((t=>t===e.target));this.areaDrop=t||null,this.options.onDragDrop(e,this.element,this.areaFrom,this.areaDrop)}bindEvents(){this.element.addEventListener("dragstart",this.dragStart),this.element.addEventListener("dragend",this.dragEnd)}unbindEvents(){this.element.removeEventListener("dragstart",this.dragStart),this.element.removeEventListener("dragend",this.dragEnd)}}var L=[{pattern:[["→┌┌┴●"],["● ┌│●"],["●┌│┌●"],["●┌┌┌◄"]],missed:"─"},{pattern:[["┌│││╡"],["┌─┌│┌"],["┌┌│┌┌"],["→│ │◄"]],missed:"┬"},{pattern:[["↓●┌◄╥"],["┌┌┌│┤"],["└  └┌"],["┌●┌┌┌"]],missed:"┌┌"},{pattern:[["→┌┌│╡"],["┌│ │╡"],["╞┼ │╡"],["╞┌ ┌┌"],["╞│┌┌◄"]],missed:"┤┤┼"},{pattern:[["┌│┌  ┌┌"],["┌┌┌●●┌┌"],["┌┌┌●┌┌┌"],["┌┌┌●│┌ "],["→┌┌●┌┌▲"]],missed:"──┐"},{pattern:[["└┐─│┐┤┼┤"],["┌ ┬ ┌●┌┌"],["┌┌●┌│┌┌┌"],["┌┌←┌┌●┌│"],["┐┌┌┐ ┌┌┌"],["┌└│─▲┌┌╨"]],missed:"──┐┤"}];const f=document.querySelector(".canvas"),_=document.querySelector(".moves"),E=document.querySelector(".parts-cnt");document.querySelector(".trash");class T{constructor(e){var t;this.moves=0,this.startTime=new Date,this.levelPattern=L[e].pattern.flat(1/0),this.missedPart=null==(t=L[e])?void 0:t.missed,this.rowCount=0,this.colCount=0,this.level=this.parseLevelText(),this.startPoint=null,this.endPoints=[],this.generateMissedPart()}generateMissedPart(){if(E.innerHTML="",this.missedPart){this.missed={},[...this.missedPart].forEach((e=>{void 0===this.missed[e]&&(this.missed[e]=0),this.missed[e]++}));for(let[e,t]of Object.entries(this.missed)){const i=d.find((t=>t.icon===e)),s=u.generateHTML(i.active,i.inactive,i.type);s.draggable=!0,s.inactive=!0;const n=document.createElement("div");n.classList.add("parts-pipe-place"),n.dataset.type=i.type,n.dataset.types=i.types,n.append(s);const a=document.createElement("div");a.classList.add("parts-pipe-nr"),a.innerHTML=t,n.append(a),E.append(n)}}}parseLevelText(){const e=[];for(let t of this.levelPattern){let i=[];for(let e of t){const t=d.find((t=>t.icon===e)),s=new u(r({},t),this.clickOnTile.bind(this));i.push(s)}e.push(i)}return e}checkEndLevel(){let e=0,t=0;console.log(this.level);for(let i=0;i<this.level.length;i++)for(let s=0;s<this.level[i].length;s++){const n=this.level[i][s];g.includes(n.type)&&(e++,n.active&&t++)}if(t>=e){const e=(new Date).getTime()-this.startTime,t=new Date(1e3*e).toISOString().substr(11,8);let i="background: gold; color: red; padding: 10px; font-size: 20px;";console.log("%cKONIEC",i),console.log("%cLiczba ruchów: "+this.moves,i),console.log("%cCzas ukończenia: "+t,i),setTimeout((()=>{document.querySelector("#popup").style.display="flex"}),1e3)}}resetTileStatus(){for(let e=0;e<this.level.length;e++)for(let t=0;t<this.level[e].length;t++){const i=this.level[e][t];i.check=!1,i.active=!1}}drawElements(){f.innerHTML="";const e=new DocumentFragment;for(let t=0;t<this.level.length;t++)for(let i=0;i<this.level[t].length;i++){const s=document.createElement("div");s.classList.add("pipe-cnt"),s.dataset.x=i,s.dataset.y=t;const n=this.level[t][i];0===n.type?s.classList.add("pipe-cnt-empty"):s.append(n.div),e.append(s)}f.append(e)}checkPipeConnection(e=null,t=null){e=null===e?this.startPoint.x:e,t=null===t?this.startPoint.y:t;const i=this.level[t][e];if(i.check=!0,i.active=!0,void 0===i.points)return!1;for(let s of i.points){if("L"===s&&e>0){const i=this.level[t][e-1];!i.check&&h.includes(i.type)&&this.checkPipeConnection(e-1,t)}if("R"===s&&e<this.colCount-1){const i=this.level[t][e+1];!i.check&&l.includes(i.type)&&this.checkPipeConnection(e+1,t)}if("T"===s&&t>0){const i=this.level[t-1][e];!i.check&&y.includes(i.type)&&this.checkPipeConnection(e,t-1)}if("B"===s&&t<this.rowCount-1){const i=this.level[t+1][e];!i.check&&v.includes(i.type)&&this.checkPipeConnection(e,t+1)}}}increaseMoves(){this.moves++;const e=String(this.moves),t=Math.max(2,e.length);_.innerHTML=e.padStart(t,"0")}clickOnTile(){this.resetTileStatus(),this.checkPipeConnection(),this.checkEndLevel(),this.increaseMoves()}createCanvas(){this.rowCount=this.level.length,this.colCount=this.level[0].length,f.innerHTML="",f.style.gridTemplateColumns=`repeat(${this.colCount}, 1fr)`,f.style.gridTemplateRows=`repeat(${this.rowCount}, 1fr)`,this.drawElements()}init(){for(let e=0;e<this.level.length;e++)for(let t=0;t<this.level[e].length;t++){const i=this.level[e][t];"◄▲►▼".includes(i.icon)&&this.endPoints.push({x:t,y:e}),"←↑→↓".includes(i.icon)&&(this.startPoint={x:t,y:e})}this.endPoints.length&&this.startPoint?(this.createCanvas(),this.checkPipeConnection(this.startPoint.x,this.startPoint.y)):alert("Błędne dane we wzorze poziomu!")}}document.querySelector(".canvas");const b=document.querySelector(".moves");document.querySelector(".parts-cnt");const D=document.querySelector(".trash");let S=0,k=new T(S);k.init(),O();const P=document.querySelector("select");P.style.cssText="\n    position:absolute;\n    left: 10px;\n    bottom: 10px;\n",L.forEach(((e,t)=>{const i=document.createElement("option");i.value=t,i.innerHTML=`level ${t}`,P.append(i)})),P.onchange=function(){S=P.value,new T(S).init(),O()};const w=document.querySelector(".popup");function O(){const e=document.querySelectorAll(".parts-cnt .pipe"),t=document.querySelectorAll(".pipe-cnt-empty");function i(e){const t=document.querySelectorAll(".pipe-cnt-empty, .trash");new m(e,t,{onDragStart:(e,t)=>{setTimeout((()=>{t.classList.add("invisible"),document.body.append(t)}),0)},onDragEnter:(e,t,i,s)=>{i.classList.add("hovered"),i.classList.add("pipe-cnt-dragged-placed")},onDragEnd:(e,t,i,s)=>{t.classList.remove("invisible"),t.classList.remove("dragged")},onDragLeave:(e,t,i,s)=>{i.classList.remove("hovered"),i.classList.remove("pipe-cnt-dragged-placed")},onDragDrop:(e,t,s,n)=>{if(n)if(n.classList.remove("hovered"),n.classList.remove("pipe-cnt-dragged-placed"),n===D){{const{x:e,y:t}=s.dataset;k.level[t][e]=new u(r({},d.find((e=>0===e.type))))}t.remove();const e=t.dataset.type,i=[...document.querySelectorAll(".parts-pipe-place")].find((t=>t.dataset.types.split(",").includes(e)));console.log(i);i.querySelector(".parts-pipe-nr").innerHTML++;const n=i.querySelector(".pipe");n.classList.remove("invisible"),n.classList.remove("dragged")}else if(console.log(n.querySelector(".pipe")),s===n||n.querySelector(".pipe"))s.append(t);else{{const{x:e,y:t}=s.dataset;k.level[t][e]=new u(r({},d.find((e=>0===e.type))))}const{x:e,y:a}=n.dataset,o=t.dataset.type,c=new u(r({},d.find((e=>e.type===+o))),k.clickOnTile.bind(k));k.level[a][e]=c,k.increaseMoves(),n.append(c.div),c.draggable=!0,i(c.div),k.resetTileStatus(),k.checkPipeConnection(),k.checkEndLevel()}else s.append(t)}}).bindEvents()}e.forEach((e=>{new m(e,t,{onDragStart:(e,t)=>{const i=t.parentElement.querySelector(".parts-pipe-nr");i.innerHTML--,i.innerHTML<=0&&setTimeout((()=>{t.classList.add("invisible")}),0)},onDragEnter:(e,t,i,s)=>{i.classList.add("hovered"),i.classList.add("pipe-cnt-dragged-placed")},onDragEnd:(e,t,i,s)=>{},onDragLeave:(e,t,i,s)=>{i.classList.remove("hovered"),i.classList.remove("pipe-cnt-dragged-placed")},onDragDrop:(e,t,s,n)=>{const a=+t.dataset.type,o=t.parentElement.querySelector(".parts-pipe-nr");if(!n)return o.innerHTML++,t.classList.remove("invisible"),void t.classList.remove("dragged");n.classList.remove("hovered"),n.classList.remove("pipe-cnt-dragged-placed");const{x:c,y:p}=n.dataset,l=d.find((e=>e.type===+a)),h=new u(r({},l),k.clickOnTile.bind(k));k.level[p][c]=h,h.draggable=!0,n.append(h.div),k.increaseMoves(),k.resetTileStatus(),k.checkPipeConnection(),k.checkEndLevel(),i(h.div)}}).bindEvents()}))}document.querySelector(".popup-button").onclick=e=>{w.style.display="none",b.innerHTML="00",S++,S>5&&(S=0),k=new T(S),k.init(),O()};
